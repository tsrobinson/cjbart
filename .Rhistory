base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper",
color = covar)) +
geom_ribbon(color = "grey30")
if (!is.null(covar) & se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper",
color = covar)) +
geom_ribbon(color = "grey30")
} else if (!is.null(covar) & !se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
color = covar))
} else if (is.null(covar) & se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper")) +
geom_ribbon(alpha = 0.3)
} else {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce"))
}
base_plot <- base_plot +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
plot(base_plot)
if (!is.null(covar) & se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper",
color = covar)) +
geom_ribbon(color = NA)
} else if (!is.null(covar) & !se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
color = covar))
} else if (is.null(covar) & se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper")) +
geom_ribbon(alpha = 0.3)
} else {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce"))
}
base_plot <- base_plot +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
plot(base_plot)
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper",
color = covar)) +
geom_ribbon(color = NA, fill = "grey30")
if (!is.null(covar) & se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper",
color = covar)) +
geom_ribbon(color = NA, fill = "grey30")
} else if (!is.null(covar) & !se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
color = covar))
} else if (is.null(covar) & se) {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce",
ymin = "lower",
ymax = "upper")) +
geom_ribbon(alpha = 0.3)
} else {
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce"))
}
base_plot <- base_plot +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
plot(base_plot)
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}}
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = "lower", ymax = "upper"), color = NA, fill = grey60, alpha = 0.3)}} +
ggplot2::facet_wrap(~.data$att, scales = "free")
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = "lower", ymax = "upper"), color = NA, fill = "grey60", alpha = 0.3)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.3)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.5)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.7) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
if (typeof(plot_data[[covar]]) == "double") {
final_plot <- base_plot +
ggplot2::scale_color_gradient(low = "dodgerblue3", high = "goldenrod1")
} else {
final_plot <- base_plot +
ggplot2::scale_colour_manual(values=c("#000000", # Colour-blind friendly pallete
"#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7"))
}
plot(final_plot)
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.8) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
if (typeof(plot_data[[covar]]) == "double") {
final_plot <- base_plot +
ggplot2::scale_color_gradient(low = "dodgerblue3", high = "goldenrod1")
} else {
final_plot <- base_plot +
ggplot2::scale_colour_manual(values=c("#000000", # Colour-blind friendly pallete
"#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7"))
}
plot(final_plot)
setwd("~/Dropbox/cjbart")
load_all()
rm(summary.cjbart)
rm(.var_to_se)
load_all()
plot(immig_het)
covar = NULL
plot(immig_het)
COVAR
covar
plot(immig_het)
rm(covar)
plot(immig_het)
x = immig_het
plot_levels = NULL, se = TRUE, covar = NULL
plot_levels = NULL
se = TRUE
covar = NULL
data <- x$imce
plot_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce",
data = data)
if (se) {
se_data <- .var_to_se(as.data.frame(x$imce_var), N = nrow(x$omce)/nrow(x$imce))
se_data[[x$id_var]] <- data[[x$id_var]]
se_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce_se",
data = se_data)
plot_data <- left_join(plot_data, se_data, by = c("att", x$id_var))
plot_data$lower <- plot_data$imce - 1.96*plot_data$imce_se
plot_data$upper <- plot_data$imce + 1.96*plot_data$imce_se
}
if (!is.null(plot_levels)) {
plot_data <- plot_data[plot_data$att %in% plot_levels,]
if (nrow(plot_data) == 0) {
stop("Filtering attribute levels renders data with no observations -- please check plot_levels argument.")
}
}
plot_data <- do.call(
rbind,
by(
plot_data,
INDICES = plot_data$att,
FUN = function(x) {
x_ordered <- x[order(x$imce),]
x_ordered$x_order <- 1:nrow(x_ordered)
return(x_ordered)
}
)
)
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.8) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
if (typeof(plot_data[[covar]]) == "double") {
final_plot <- base_plot +
ggplot2::scale_color_gradient(low = "dodgerblue3", high = "goldenrod1")
} else {
final_plot <- base_plot +
ggplot2::scale_colour_manual(values=c("#000000", # Colour-blind friendly pallete
"#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7"))
}
data <- x$imce
plot_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce",
data = data)
if (se) {
se_data <- .var_to_se(as.data.frame(x$imce_var), N = nrow(x$omce)/nrow(x$imce))
se_data[[x$id_var]] <- data[[x$id_var]]
se_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce_se",
data = se_data)
plot_data <- left_join(plot_data, se_data, by = c("att", x$id_var))
plot_data$lower <- plot_data$imce - 1.96*plot_data$imce_se
plot_data$upper <- plot_data$imce + 1.96*plot_data$imce_se
}
if (!is.null(plot_levels)) {
plot_data <- plot_data[plot_data$att %in% plot_levels,]
if (nrow(plot_data) == 0) {
stop("Filtering attribute levels renders data with no observations -- please check plot_levels argument.")
}
}
plot_data <- do.call(
rbind,
by(
plot_data,
INDICES = plot_data$att,
FUN = function(x) {
x_ordered <- x[order(x$imce),]
x_ordered$x_order <- 1:nrow(x_ordered)
return(x_ordered)
}
)
)
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.8) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
if (!is.null(covar) & typeof(plot_data[[covar]]) == "double") {
final_plot <- base_plot +
ggplot2::scale_color_gradient(low = "dodgerblue3", high = "goldenrod1")
} else if(!is.null(covar)) {
final_plot <- base_plot +
ggplot2::scale_colour_manual(values=c("#000000", # Colour-blind friendly pallete
"#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7"))
}
data <- x$imce
plot_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce",
data = data)
if (se) {
se_data <- .var_to_se(as.data.frame(x$imce_var), N = nrow(x$omce)/nrow(x$imce))
se_data[[x$id_var]] <- data[[x$id_var]]
se_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce_se",
data = se_data)
plot_data <- left_join(plot_data, se_data, by = c("att", x$id_var))
plot_data$lower <- plot_data$imce - 1.96*plot_data$imce_se
plot_data$upper <- plot_data$imce + 1.96*plot_data$imce_se
}
if (!is.null(plot_levels)) {
plot_data <- plot_data[plot_data$att %in% plot_levels,]
if (nrow(plot_data) == 0) {
stop("Filtering attribute levels renders data with no observations -- please check plot_levels argument.")
}
}
plot_data <- do.call(
rbind,
by(
plot_data,
INDICES = plot_data$att,
FUN = function(x) {
x_ordered <- x[order(x$imce),]
x_ordered$x_order <- 1:nrow(x_ordered)
return(x_ordered)
}
)
)
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.8) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
data <- x$imce
plot_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce",
data = data)
if (se) {
se_data <- .var_to_se(as.data.frame(x$imce_var), N = nrow(x$omce)/nrow(x$imce))
se_data[[x$id_var]] <- data[[x$id_var]]
se_data <- tidyr::pivot_longer(cols = x$att_levels,
names_to = "att",
values_to = "imce_se",
data = se_data)
plot_data <- left_join(plot_data, se_data, by = c("att", x$id_var))
plot_data$lower <- plot_data$imce - 1.96*plot_data$imce_se
plot_data$upper <- plot_data$imce + 1.96*plot_data$imce_se
}
if (!is.null(plot_levels)) {
plot_data <- plot_data[plot_data$att %in% plot_levels,]
if (nrow(plot_data) == 0) {
stop("Filtering attribute levels renders data with no observations -- please check plot_levels argument.")
}
}
plot_data <- do.call(
rbind,
by(
plot_data,
INDICES = plot_data$att,
FUN = function(x) {
x_ordered <- x[order(x$imce),]
x_ordered$x_order <- 1:nrow(x_ordered)
return(x_ordered)
}
)
)
base_plot <- ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.8) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
if (!is.null(covar)) {
if (typeof(plot_data[[covar]]) == "double") {
base_plot <- base_plot +
ggplot2::scale_color_gradient(low = "dodgerblue3", high = "goldenrod1")
} else {
base_plot <- base_plot +
ggplot2::scale_colour_manual(values=c("#000000", # Colour-blind friendly pallete
"#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7"))
}
}
load_all()
plot(immig_het, plot_levels = "High School")
colnames(immig_het$imce)
plot(immig_het, plot_levels = c("High School","Graduate Degree","4th Grade"))
plot(immig_het, plot_levels = c("High School","Graduate Degree","4th Grade", "College Degree"))
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
ggplot2::geom_hline(xintercept = 0, size = 0.5, linetype = "dashed") +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.8) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
?geom_hline
ggplot2::ggplot(plot_data,
ggplot2::aes_string(x = "x_order",
y = "imce")) +
ggplot2::geom_hline(yintercept = 0, size = 0.5, linetype = "dashed") +
{if (!is.null(covar)) {ggplot2::aes_string(color = covar)}} +
{if (se) {ggplot2::geom_ribbon(ggplot2::aes(ymin = lower, ymax = upper), color = NA, fill = "grey60", alpha = 0.7)}} +
ggplot2::facet_wrap(~.data$att, scales = "free") +
ggplot2::geom_point(alpha = 0.8) +
ggplot2::ylab("IMCE") +
ggplot2::xlab("Individual") +
ggplot2::theme(legend.position = "bottom",
axis.text.x=ggplot2::element_blank(),
axis.ticks.x=ggplot2::element_blank())
load_all()
plot(immig_het, plot_levels = c("High School","Graduate Degree","4th Grade", "College Degree"))
plot(immig_het)
unique(immigration$JobPlans)
unique(immigration$Job)
plot(immig_het, plot_levels = unique(immigration$Job))
