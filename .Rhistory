install_github("MIDASverse/rMIDAS")
devtools::install_github("MIDASverse/rMIDAS")
library(knitr)
detach("package:knitr", unload = TRUE)
library(knitr)
install.packages(c("gh", "isoband", "lme4", "MatchIt", "processx", "rlang"))
install.packages(c("gh", "isoband", "lme4", "MatchIt", "processx", "rlang"))
install.packages(c("gh", "isoband", "lme4", "MatchIt", "processx", "rlang"))
install.packages(c("gh", "isoband", "lme4", "MatchIt", "processx", "rlang"))
setwd("~/Dropbox/cjbart")
library(devtools)
library(tidyverse)
load_all()
data <- read_csv("../../Downloads/nbh_clean_conjoint_global.csv") %>%
select(-all_of(c("person","ans","candidate")))
bart_mode <- cjbart(data, "select","id", seed = 89, keeptrainfits = FALSE)
marginal <- cjbart::OMCE(data, bart_mode,
attribs = c("transmission",
"vulnerability",
"occupation",
"income",
"age_category"),
ref_levels = c("Average risk of catching and transmitting the COVID-19 virus",
"Average risk of COVID-19 death",
"Not working",
"Average income level",
"25 years old"),
Y_var = "select",
id = "id",
cores = 14)
marignal2 <- list()
marginal2$imce <- marginal$imce %>% filter(!is.na(education))
bart_mode <- cjbart(data, "select","id", seed = 89, keeptrainfits = FALSE)
}
}
cjbart <- function(data, Y_var, id_var = NULL, ...) {
if (missing(Y_var)) {
stop("Please declare the output variable using the Y_var argument.")
}
if (!missing(id_var)) {
if (!(id_var %in% names(data))) {
stop("Supplied id_var not present in data.")
}
}
train_vars <- names(data)[!(names(data) %in% c(id_var,Y_var))]
train_X <- data[, train_vars]
train_X <- .char_to_fact(train_X)
train_Y <- data[[Y_var]]
train_model <- BART::pbart(x.train = as.data.frame(train_X),
y.train = train_Y, ...)
return(train_model)
}
rm(cjbart)
bart_mode <- cjbart(data, "select","id", seed = 89, keeptrainfits = FALSE)
library(cjbart)
bart_mode <- cjbart(data, "select","id", seed = 89, keeptrainfits = FALSE)
?pbart
mc.pbart
?mc.pbart
load_all()
data <- read_csv("../../Downloads/nbh_clean_conjoint_global.csv") %>%
select(-all_of(c("person","ans","candidate")))
bart_mode <- cjbart(data, "select","id", seed = 89, keeptrainfits = FALSE)
marginal <- cjbart::OMCE(data, bart_mode,
attribs = c("transmission",
"vulnerability",
"occupation",
"income",
"age_category"),
ref_levels = c("Average risk of catching and transmitting the COVID-19 virus",
"Average risk of COVID-19 death",
"Not working",
"Average income level",
"25 years old"),
Y_var = "select",
id = "id",
cores = 14)
marignal2 <- list()
marginal2$imce <- marginal$imce %>% filter(!is.na(education))
load_all()
bart_mode <- cjbart(data, "select","id", seed = 89, keeptrainfits = FALSE)
marginal <- cjbart::OMCE(data, bart_mode,
attribs = c("transmission",
"vulnerability",
"occupation",
"income",
"age_category"),
ref_levels = c("Average risk of catching and transmitting the COVID-19 virus",
"Average risk of COVID-19 death",
"Not working",
"Average income level",
"25 years old"),
Y_var = "select",
id = "id",
cores = 14)
marignal2 <- list()
rm(marignal2)
marginal2 <- list()
marginal2$imce <- marginal$imce %>% filter(!is.na(education))
marginal2$omce <- marginal$omce
plot(marginal2, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
?plot.cjbart
class(marginal2) <- "cjbart"
plot(marginal2, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
plot(marginal, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
marginal2 <- marginal
marginal2$imce <- marginal2$imce %>% filter(!is.na(education))
plot(marginal, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
marginal2$imce <- marginal2$imce %>% filter(!is.na(education)) %>% mutate(education = factor(education))
plot(marginal, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
marginal2$imce <- marginal2$imce %>% filter(!is.na(education)) %>% mutate(education = factor(education, levels = c("Low","Medium","High")))
plot(marginal, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
plot(marginal2, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
marginal2 <- marginal
marginal2$imce <- marginal2$imce %>% filter(!is.na(education))
plot(marginal2, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
plot(marginal2, plot.type = "imce", covar = "education") +
ggsave("../cjbart_paper/figures/age_education.pdf")
marginal2$imce <- marginal2$imce %>% filter(!is.na(education)) %>% mutate(education = factor(education, levels = c("Low","Medium","High")))
plot(marginal2, plot.type = "imce", covar = "education") +
ggsave("../cjbart_paper/figures/age_education.pdf")
plot(marginal2, plot.type = "imce", covar = "education") +
scale_color_manual(values = c("blue","yellow","red")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
marginal2 <- marginal
marginal2$imce <- marginal2$imce %>% filter(!is.na(education)) %>% mutate(education = factor(education, levels = c("Low","Medium", "High")))
plot(marginal2, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
colnames(data)
plot(marginal2, plot.type = "imce", covar = "age")
marginal2$imce <- marginal2$imce %>%
filter(!is.na(education),
age < 100) %>%
mutate(education = factor(education, levels = c("Low","Medium", "High")))
plot(marginal2, plot.type = "imce", covar = "education",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_education.pdf")
marginal2$imce
plot(marginal2, plot.type = "imce", covar = "age")
plot(marginal2, plot.type = "imce", covar = "age") +
scale_color_continuous(low = "blue", high = "red")
plot(marginal2, plot.type = "imce", covar = "age") +
scale_color_continuous(low = "blue", high = "yellow")
colnames(Data)
colnames(data)
plot(marginal2, plot.type = "imce", covar = "gender")
plot(marginal2, plot.type = "hes_covid_2", covar = "gender")
plot(marginal2, plot.type = "imce", covar = "hes_covid_2")
marginal2$imce <- marginal2$imce %>%
filter(!is.na(education),
age < 100,
!is.na(gender),
!is.na(hes_covid_2)) %>%
mutate(education = factor(education, levels = c("Low","Medium", "High")))
plot(marginal2, plot.type = "imce", covar = "hes_covid_2")
plot(marginal2, plot.type = "imce", covar = "gender") +
ggsave("../cjbart_paper/figures/all_gender.pdf")
colnames(data)
plot(marginal2, plot.type = "imce", covar = "country")
plot(marginal2, plot.type = "imce", covar = "country") +
scale_colour_brewer(palette = "Set1")
plot(marginal2, plot.type = "imce", covar = "age",
plot_levels = c("40 years old","65 years old","79 years old")) +
ggsave("../cjbart_paper/figures/age_age.pdf")
