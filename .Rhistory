?event_study
data(df_het, package = "did2s")
out = event_study(
data = df_het, yname = "dep_var", idname = "unit",
tname = "year", gname = "g"
)
View(out)
?did2s
castle2 <- as.matrix(caste)
castle2 <- as.matrix(castle)
did2s(
data = castle2,
yname = "l_homicide",
first_stage = ~ 0 | sid + year,
second_stage = ~ i(post, ref=0),
treatment = "post",
cluster_var = "state", weights = "popwt"
)
did2s(
data = castle2,
yname = "l_homicide",
first_stage = ~ 0 | sid + year,
second_stage = ~ i(post, ref=0),
treatment = "post",
cluster_var = "state", weights = "popwt"
)
did2s
?did2s
castle2 <- as.matrix(castle)
View(castle2)
did2s(
data = castle,
yname = "l_homicide",
first_stage = ~ 0 | sid + year,
second_stage = ~ i(post, ref=0),
treatment = "post",
cluster_var = "state", weights = "popwt"
)
did2s(
data = castle2,
yname = "l_homicide",
first_stage = ~ 0 | sid + year,
second_stage = ~ i(post, ref=0),
treatment = "post",
cluster_var = "state", weights = "popwt"
)
test_mat <- matrix(1:9,3,3)
test_mat
test_mat[[1]]
library(MASS)
?polr
?predict.polr
?polr
options(contrasts = c("contr.treatment", "contr.poly"))
house.plr <- polr(Sat ~ Infl + Type + Cont, weights = Freq, data = housing)
house.plr
summary(house.plr, digits = 3)
## slightly worse fit from
summary(update(house.plr, method = "probit", Hess = TRUE), digits = 3)
## although it is not really appropriate, can fit
summary(update(house.plr, method = "loglog", Hess = TRUE), digits = 3)
summary(update(house.plr, method = "cloglog", Hess = TRUE), digits = 3)
predict(house.plr, housing, type = "p")
addterm(house.plr, ~.^2, test = "Chisq")
house.plr2 <- stepAIC(house.plr, ~.^2)
house.plr2$anova
anova(house.plr, house.plr2)
house.plr <- update(house.plr, Hess=TRUE)
pr <- profile(house.plr)
pr
plot(pr)
print("hello")
?geom_density
library(ggplot2)
?geom_density
?density
setwd("Dropbox/cjbart_paper")
devtools::load_all("../cjbart")
zhirkov <- read_csv("~/Downloads/zhirkov_data")
library(tidyverse)
zhirkov <- read_csv("~/Downloads/zhirkov_data")
zhirkov <- read_csv("~/Downloads/zhirkov_data.csv")
zhirkov <- read_dta("~/Downloads/zhirkov_data.csv")
library(haven)
zhirkov <- read_dta("~/Downloads/zhirkov_data.csv")
zhirkov <- read_dta("~/Downloads/zhirkov_data.dta")
View(zhirkov)
colnames(zhirkov)
?across
zhirkov_analysis <- zhirkov %>%
select(respid, rate, age_int, sex_bin, race_at, educ_cat, lang_cat, trip_cat) %>%
mutate(across(!contains(rate), as.factor))
zhirkov_analysis <- zhirkov %>%
select(respid, rate, age_int, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
mutate(across(!contains(rate), as.factor))
zhirkov_analysis <- zhirkov %>%
select(respid, rate, age_int, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
mutate(across(-rate, as.factor))
summary(zhirkov_analysis)
zhirkov_analysis <- zhirkov %>%
select(respid, rate, age_int, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
mutate(across(-all_of(vars(rate, age_int)), as.factor))
zhirkov_analysis <- zhirkov %>%
select(respid, rate, age_int, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
mutate(across(-vars(rate, age_int), as.factor))
zhirkov_analysis <- zhirkov %>%
select(respid, rate, age_int, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
mutate(across(-rate, -age_int, as.factor))
zhirkov_analysis <- zhirkov %>%
select(respid, rate, age_int, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
mutate(across(-c(rate, age_int), as.factor))
summary(zhirkov_analysis)
?cjbart
zhirkov_mod <- cjbart(zhirkov_analysis, id = "respid")
zhirkov_mod <- cjbart(zhirkov_analysis, id = "respid", Y = "rate")
View(zhirkov_analysis)
z_Survey <- read_dta("~/Downloads/zhirkov_survey.dta")
colnames(z_Survey)
z <- read_dta("~/Downloads/zhirkov_data.dta")
z_survey <- read_dta("~/Downloads/zhirkov_survey.dta")
View(z_survey)
z_analysis <- z %>%
select(respid, rate, age_int, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age_int, age), as.factor))
View(z)
z_analysis <- z %>%
select(respid, rate, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor))
z_mod <- cjbart(zhirkov_analysis, id = "respid", Y = "rate")
?imce
z_mod <- cjbart(zhirkov_analysis, id = "respid", Y = "rate")
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
BART::bartModelMatrix(z_analysis)
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
X_pred0
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
X_pred0
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
z_analysis <- z %>%
select(respid, rate, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor))
z_mod <- cjbart(z_analysis, id = "respid", Y = "rate")
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
z %>% group_by(respid) %>% mutate(choose == ifelse(rate == max(rate), 1,0))
z %>% group_by(respid) %>% mutate(choose = ifelse(rate == max(rate), 1,0))
z_analysis <- z %>%
select(respid, rate, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = ifelse(rate == max(rate), 1, 0)) %>%
ungroup()
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = ifelse(rate == max(rate), 1, 0)) %>%
ungroup() %>%
select(-rate, -scenario)
z_analysis
View(z_analysis)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = ifelse(rate == max(rate), 1, 0)) %>%
ungroup() %>%
select(-scenario)
z_analysis %>% group_by(respid, scenario) %>% mutate(same = ifelse(length(unique(rate)) == 1,0.5,0))
z %>% group_by(respid, scenario) %>% mutate(same = ifelse(length(unique(rate)) == 1,0.5,0))
z %>% group_by(respid, scenario) %>% mutate(same = ifelse(length(unique(rate)) == 1,0.5,0)) %>% ungroup() %>% summarise(sum(same))
z %>% group_by(respid, scenario) %>% mutate(same = ifelse(length(unique(rate)) == 1,1,0)) %>% ungroup() %>% summarise(sum(same))
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0,
TRUE ~ NA)) %>%
ungroup() %>%
select(-scenario)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(.$rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0,
TRUE ~ NA)) %>%
ungroup() %>%
select(-scenario)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0,
TRUE ~ NA)) %>%
ungroup() %>%
select(-scenario)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(unique(rate) == rate ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0,
TRUE ~ NA)) %>%
ungroup() %>%
select(-scenario)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(rate == max(rate) ~ 1,
rate < max(rate) ~ 0,
TRUE ~ NA)) %>%
ungroup() %>%
select(-scenario)
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
select(-scenario)
z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario)
z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)
z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0))
z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario)
View(z_analysis)
z_mod <- cjbart(z_analysis, id = "respid", Y = "choice")
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ 0.5,
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario, -rate)
colnames(z_analysis)
z_mod <- cjbart(z_analysis, id = "respid", Y = "choice")
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
x
z_mod
View(z_mod)
View(z_mod)
View(z_mod)
View(z_mod)
View(z_mod)
z_analysis
z_analysis$choice
rbinom(1,2,0.5)
rbinom(1,2,0.5)
rbinom(1,2,0.5)
rbinom(1,2,0.5)
rbernoulli(2)
as.numeric(rbernoulli(2))
as.numeric(rbernoulli(2))
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
sample(c(1,2),2)
sample(c(1,2),2)
sample(c(1,2),2)
sample(c(1,2),2)
sample(c(1,2),2)
sample(c(1,2),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
sample(c(1,0),2)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario, -rate)
z_mod <- cjbart(z_analysis, id = "respid", Y = "choice")
z_IMCEs <- IMCE(z_analysis, z_mod,
attribs = c("age_bin","sex_bin","race_cat","educ_cat","lang_cat","trip_cat"),
ref_levels = c("1","1","1","1","1","1"))
View(z_mod)
View(z_mod)
z_analysis
View(z_analysis)
BART()
library(BART)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario, -rate)
summary(z_analysis)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(age, ethnocentrism), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario, -rate)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age, ethnocentrism), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario, -rate)
z_mod <- cjbart(z_analysis, id = "respid", Y = "choice")
View(z_mod)
pbart(x.train = z_analysis[,!(names(z_analyis) %in% c("respid","choice"))])
pbart(x.train = z_analysis[,!(names(z_analyis) %in% c("respid","choice"))], y.train = z_analysis$choice)
pbart(x.train = z_analysis[,!(names(z_analysis) %in% c("respid","choice"))], y.train = z_analysis$choice)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
left_join(z_survey, by = "respid") %>%
mutate(across(-c(rate, age, ethnocentrism), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario, -rate) %>%
as.data.frame()
pbart(x.train = z_analysis[,!(names(z_analysis) %in% c("respid","choice"))], y.train = z_analysis$choice)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
# left_join(z_survey, by = "respid") %>%
# mutate(across(-c(rate, age, ethnocentrism), as.factor)) %>%
mutate(across(-c(rate), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
select(-scenario, -rate) %>%
as.data.frame()
z_analysis
summary(z_analysis)
?pbart
z_mod <- cjbart(z_analysis, id = "respid", Y = "choice")
View(z_mod)
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
# left_join(z_survey, by = "respid") %>%
# mutate(across(-c(rate, age, ethnocentrism), as.factor)) %>%
mutate(across(-c(rate), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
mutate(choice = as.integer(choice)) %>%
select(-scenario, -rate) %>%
as.data.frame()
z_mod <- cjbart(z_analysis, id = "respid", Y = "choice")
View(z_mod)
z_analysis$choice
z_analysis$choice
summary(z_analysis$choice)
?cjbart
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
# left_join(z_survey, by = "respid") %>%
# mutate(across(-c(rate, age, ethnocentrism), as.factor)) %>%
mutate(across(-c(rate), as.factor)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
mutate(choice = as.integer(choice)) %>%
select(-rate) %>%
as.data.frame()
z_mod <- cjbart(z_analysis, id = "respid", round = scenario, Y = "choice")
z_mod <- cjbart(z_analysis, id = "respid", round = "scenario", Y = "choice")
View(z_mod)
subjects <- 5
rounds <- 2
profiles <- 2
obs <- subjects*rounds*profiles
fake_data <- data.frame(A = sample(c("a1","a2"), obs, replace = TRUE),
B = sample(c("b1","b2"), obs, replace = TRUE),
id1 = rep(1:subjects, each=rounds),
stringsAsFactors = TRUE)
fake_data$Y <- sample(c(0,1), obs, replace = TRUE)
cj_model <- cjbart(data = fake_data,
Y = "Y",
id = "id1")
cj_model
View(cj_model)
z_analysis$age_bin
z_analysis <- z %>%
select(respid, rate, scenario, age_bin, sex_bin, race_cat, educ_cat, lang_cat, trip_cat) %>%
# left_join(z_survey, by = "respid") %>%
# mutate(across(-c(rate, age, ethnocentrism), as.factor)) %>%
mutate(across(-c(rate), as.character)) %>%
group_by(respid, scenario) %>%
mutate(choice = case_when(length(unique(rate)) == 1 ~ sample(c(1,0),2),
rate == max(rate) ~ 1,
rate < max(rate) ~ 0)) %>%
ungroup() %>%
mutate(choice = as.integer(choice)) %>%
select(-rate) %>%
as.data.frame()
z_mod <- cjbart(z_analysis, id = "respid", round = "scenario", Y = "choice")
View(z_mod)
View(z_mod)
load("/Users/tomrobinson/Downloads/candidate_marginals.rdata")
View(marUse)
setwd("../cjbart")
devtools::check()
?randomForestSRC::rfsrc
?randomForestSRC::vimp
?randomForestSRC::vimp.rfsrc
?randomForestSRC::extract.subsample
?randomForest::rfsrc
?randomForestSRC::rfsrc
devtools::check()
devtools::check()
